<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-animated-pages/core-animated-pages.html">
<script src="../bower_components/underscore/underscore.js"></script>

<polymer-element name="my-gallery" attributes="images selectedImage page" vertical layout>
<template>
    <style>
        :host {
            display: block;
        }

        .card, .chip {
            background: white;
            text-align: start;
        }

        .card {
            padding: 10px;
            height: 100%;
        }

        .card > img {
            margin-right: 20px;
            max-width: 50%;
        }

        .chip {
            height: 250px;
            display: inline-block;
            position: relative;
            margin: 5px;
        }

        .chip > img {
            max-height: 200px;
        }

        .chip .imageAction {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            background-color: rgba(0,0,0,.8);
            color: white;
        }

        .chip .caption {
            height: 30px;
            background-color: rgba(0, 0, 0, .8);
            color:white;
            line-height: 30px;
        }
    </style>

    <core-animated-pages id="pages" selected="{{page}}" transitions="hero-transition" flex>
    
        <section>
            <div class="chip-container" hero-p layout horizontal wrap>
                <template repeat="{{image in images}}">
                <div class="chip" on-tap="{{showDetails}}" layout vertical hero-id="{{image.url}}" end-justified hero?="{{selectedImage === image}}"> 
                        <img src="{{image.url}}" hero-id="{{image.url}}.art" hero?="{{selectedImage === image}}">
                        <div class="caption">{{image.name}}</div>
                        <core-icon-button class="imageAction" icon="{{ actionIcon(image) }}" on-tap="{{doAction}}">{{actionLabel(image)}}</core-icon-button>
                    </div>
                </template>
            </div>
        </section>

        <section id="details">
            <div class="card" horizontal layout hero hero-id="{{selectedImage.url}}" start-justified>
                <img src="{{selectedImage.url}}" hero hero-id="{{selectedImage.url}}.art" self-start/>
                <content select="div#info" layout vertical flex></content>
            </div>
        </section>
    </core-animated-pages>
</template>
<script>
    Polymer({ 
        page: 0,
        selectedImage: null,
        actionLabel: function(image) { return ""; },
        actionIcon: function(image) { return ""; },
        showDetails: function(e, d, s) {
            this.selectedImage = e.target.templateInstance.model.image;
            this.page = 1;
        },
        showList: function() {
            this.page = 0;
        },
        doAction: function(e, d, s) {
            e.stopPropagation();
            var image = this.selectedImage;
            if(s.templateInstance.model.image) {
                image = s.templateInstance.model.image;
            }
            this.fire('action-call', image);
        }
    });
</script>
</polymer-element>

