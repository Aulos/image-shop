<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../bower_components/core-media-query/core-media-query.html">
<script src="../bower_components/underscore/underscore.js"></script>

<polymer-element name="my-gallery" attributes="images selectedImage page" vertical layout>
<template>
    <style>
        :host {
            display: block;
        }

        .card, .chip {
            background: white;
            text-align: start;
        }

        .card {
            padding: 10px;
            height: 100%;
        }

        .card > img {
            margin-right: 20px;
            width: 90%;
            max-height: 90%;
        }

        .chip {
            height: 250px;
            display: inline-block;
            position: relative;
            margin: 5px;
        }

        .chip > img {
            max-height: 200px;
        }

        .chip .imageAction {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            background-color: rgba(0,0,0,.8);
            color: white;
        }

        .chip .caption {
            height: 30px;
            background-color: rgba(0, 0, 0, .8);
            color:white;
            line-height: 30px;
        }
    </style>

    <core-media-query query="max-width: 700px" queryMatches="{{phoneScreen}}"></core-media-query>

    <core-animated-pages id="pages" selected="{{page}}" transitions="hero-transition" flex>
    
        <div class="chip-container" hero-p layout horizontal?="{{!phoneScreen}}" wrap?="{{!phoneScreen}}" vertical?="{{phoneScreen}}">
            <template repeat="{{image in images}}">
                <div class="chip" on-tap="{{showDetails}}" layout vertical hero-id="{{image.url}}" end-justified hero?="{{selectedImage === image}}" auto-vertical> 
                    <img src="{{image.url}}" hero-id="{{image.url}}.art" hero?="{{selectedImage === image}}">
                    <div class="caption">{{image.name}}</div>
                    <core-icon-button class="imageAction" icon="{{ actionIcon(image) }}" on-tap="{{doAction}}">{{actionLabel(image)}}</core-icon-button>
                </div>
            </template>
        </div>

        <div class="card" hero hero-id="{{selectedImage.url}}" layout horizontal?="{{!phoneScreen}}" vertical?="{{phoneScreen}}">
            <img src="{{selectedImage.url}}" hero hero-id="{{selectedImage.url}}.art" self-start?="{{!phoneScreen}}" auto-vertical/>
            <content select="div#info" flex?="{{!phoneScreen}}" auto-vertical></content>
        </div>
    </core-animated-pages>
</template>
<script>
    Polymer({ 
        page: 0,
        selectedImage: null,
        actionLabel: function(image) { return ""; },
        actionIcon: function(image) { return ""; },
        showDetails: function(e, d, s) {
            this.selectedImage = e.target.templateInstance.model.image;
            this.page = 1;
        },
        showList: function() {
            this.page = 0;
        },
        doAction: function(e, d, s) {
            if(s.templateInstance.model.image) {
                e.stopPropagation();
                image = s.templateInstance.model.image;
                this.fire('action-call', image);
            }
        }
    });
</script>
</polymer-element>

