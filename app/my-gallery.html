<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../bower_components/core-media-query/core-media-query.html">
<script src="../bower_components/underscore/underscore.js"></script>

<polymer-element name="my-gallery" attributes="images selectedImage basket" block>
<template>
    <style>
        :host {
            display: block;
        }

        .chip-container, #pages, .card {
            height: 100%;
        }

        .card {
            padding: 10px;
        }

        .card img {
            margin-right: 20px;
            max-width: 20%;
        }

        .chip {
            max-height: 350px;
            min-height: 300px;
            margin: 5px;
            border: 1px solid #444;
            overflow: hidden;
        }

        .chip .imageAction, .chip .caption {
            background-color: #444;
            color: white;
        }

        @media screen and (max-width: 700px) {
            .chip img {
                height: 300px;
            }

            .card img {
                max-width: 100%;
            }
        }

        .chip .imageAction {
            position: absolute;
            top: 3px;
            right: 3px;
            width: 40px;
        }

        .chip .caption {
            height: 25px;
            padding: 5px;
            text-align: center;
            line-height: 25px;
        }
    </style>

    <core-media-query query="max-width: 700px" queryMatches="{{phoneScreen}}"></core-media-query>

    <core-animated-pages id="pages" selected="{{page}}" transitions="hero-transition cross-fade-all" on-core-transitioned="{{complete}}">
    
        <div class="chip-container" hero-p layout horizontal?="{{!phoneScreen}}" wrap?="{{!phoneScreen}}" vertical?="{{phoneScreen}}" start?="{{!phoneScreen}}">
            <template repeat="{{image in images}}">
            <div class="chip" on-tap="{{showDetails}}" 
                hero-id="{{image.url}}" hero?="{{selectedImage === image}}"
                center relative vertical justified layout auto-vertical> 
                    <img src="{{image.url}}" hero-id="{{image.url}}.art" hero?="{{selectedImage === image}}">
                    <div class="caption" self-stretch>{{image.name}}</div>
                    <core-icon-button class="imageAction" icon="delete" on-tap="{{remove}}" hidden?="{{basket && showAction(image) != 0}}"></core-icon-button>
                    <core-icon-button class="imageAction" icon="add-shopping-cart" on-tap="{{add}}" hidden?="{{basket && showAction(image) != 1}}"></core-icon-button>
                </div>
            </template>
        </div>

        <div class="card" layout horizontal?="{{!phoneScreen}}" vertical?="{{phoneScreen}}" flex hero-id="{{selectedImage.url}}" hero>
            <img src="{{selectedImage.url}}" hero hero-id="{{selectedImage.url}}.art" self-start?="{{!phoneScreen}}" auto-vertical on-tap="{{show}}" self-center?="{{phoneScreen}}"/>
            <div flex auto-vertical><content select="div#info"></content></div>
        </div>
    </core-animated-pages>
</template>
<script>
    Polymer({ 
        page: 0,
        selectedImage: null,
        showAction: function(image) { return -1; },
        showDetails: function(e, d, s) {
            this.selectedImage = e.target.templateInstance.model.image;
            this.page = 1;
        },
        show: function() {
            this.page = 0;
        },
        _generic: function(name, e, s) {
            if(s.templateInstance.model.image) {
                e.stopPropagation();
                image = s.templateInstance.model.image;
                this.fire(name, image);
            }
        },
        add: function(e, d, s) { this._generic('action-add', e, s); },
        remove: function(e, d, s) { this._generic('action-remove', e, s); },
    });
</script>
</polymer-element>

